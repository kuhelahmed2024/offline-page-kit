{"version":3,"sources":["../src/register.ts"],"sourcesContent":["\r\nimport type { OfflineKitRegisterOptions } from \"./types\";\r\n\r\nexport function registerOfflineKit(opts: OfflineKitRegisterOptions = {}) {\r\n    const {\r\n        swUrl = \"/sw.js\",\r\n        scope = \"/\",\r\n        debug = false,\r\n        onReady,\r\n        onUpdate,\r\n        onError,\r\n    } = opts;\r\n\r\n    if (typeof window === \"undefined\") return;\r\n    if (!(\"serviceWorker\" in navigator)) {\r\n        debug && console.warn(\"[offline-kit] Service Worker not supported\");\r\n        return;\r\n    }\r\n\r\n    window.addEventListener(\"load\", async () => {\r\n        try {\r\n            const reg = await navigator.serviceWorker.register(swUrl, { scope });\r\n            debug && console.log(\"[offline-kit] registered:\", { swUrl, scope });\r\n\r\n            onReady?.(reg);\r\n\r\n            reg.addEventListener(\"updatefound\", () => {\r\n                const installing = reg.installing;\r\n                if (!installing) return;\r\n\r\n                installing.addEventListener(\"statechange\", () => {\r\n                    if (installing.state !== \"installed\") return;\r\n\r\n                    if (navigator.serviceWorker.controller) {\r\n                        debug && console.log(\"[offline-kit] update available\");\r\n                        onUpdate?.(reg);\r\n                    } else {\r\n                        debug && console.log(\"[offline-kit] first install complete\");\r\n                    }\r\n                });\r\n            });\r\n        } catch (err) {\r\n            debug && console.error(\"[offline-kit] register failed:\", err);\r\n            onError?.(err);\r\n        }\r\n    });\r\n}"],"mappings":";AAGO,SAAS,mBAAmB,OAAkC,CAAC,GAAG;AACrE,QAAM;AAAA,IACF,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR;AAAA,IACA;AAAA,IACA;AAAA,EACJ,IAAI;AAEJ,MAAI,OAAO,WAAW,YAAa;AACnC,MAAI,EAAE,mBAAmB,YAAY;AACjC,aAAS,QAAQ,KAAK,4CAA4C;AAClE;AAAA,EACJ;AAEA,SAAO,iBAAiB,QAAQ,YAAY;AACxC,QAAI;AACA,YAAM,MAAM,MAAM,UAAU,cAAc,SAAS,OAAO,EAAE,MAAM,CAAC;AACnE,eAAS,QAAQ,IAAI,6BAA6B,EAAE,OAAO,MAAM,CAAC;AAElE,gBAAU,GAAG;AAEb,UAAI,iBAAiB,eAAe,MAAM;AACtC,cAAM,aAAa,IAAI;AACvB,YAAI,CAAC,WAAY;AAEjB,mBAAW,iBAAiB,eAAe,MAAM;AAC7C,cAAI,WAAW,UAAU,YAAa;AAEtC,cAAI,UAAU,cAAc,YAAY;AACpC,qBAAS,QAAQ,IAAI,gCAAgC;AACrD,uBAAW,GAAG;AAAA,UAClB,OAAO;AACH,qBAAS,QAAQ,IAAI,sCAAsC;AAAA,UAC/D;AAAA,QACJ,CAAC;AAAA,MACL,CAAC;AAAA,IACL,SAAS,KAAK;AACV,eAAS,QAAQ,MAAM,kCAAkC,GAAG;AAC5D,gBAAU,GAAG;AAAA,IACjB;AAAA,EACJ,CAAC;AACL;","names":[]}